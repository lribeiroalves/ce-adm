DL_SCRIPTVERSION
1
14420

' Docklight Script - Processar último byte de mensagem

Option Explicit

Dim finished
Dim inputBuffer        ' Buffer para armazenar os dados recebidos
Dim lastByte           ' Último byte variável da sequência
Dim convertedValue     ' Resultado da conversão (negativo)
Dim outputComment      ' Comentário gerado
Dim dataLength

DL.ClearCommWindows		'Limpa a janela de comunicação
DL.StartCommunication	'Abre o canal serial	
	
Do
	DL.Pause 1 		'(the pause reduces CPU load while idle) ESTUDAR
	'Call DL_OnReceive()
	Wait(300)
	DL.AddComment "Teste OK"

Loop

Sub DL_OnReceive()
	'inputBuffer = ""
	'inputBuffer = DL.OnReceive_GetData(H)
	
	'If Len(inputBuffer) > 3 Then
       	'dataLength = Len(inputBuffer)

		'If Mid(inputBuffer, dataLength - 2, 1) = Chr(&H0D) And Mid(inputBuffer, dataLength - 1, 1) = Chr(&H0A) Then
            		'Captura o byte variável (último byte)
            		'lastByte = Asc(Mid(inputBuffer, dataLength, 1))
            
            		' Calcula o valor convertido (256 - valor do byte, negativo)
           		'convertedValue = 256 - lastByte
            		'convertedValue = -convertedValue

            		' Cria o comentário para o Docklight
            		'DL.AddComment "Valor do último byte: " & lastByte & " | Valor calculado: " & convertedValue

            		' Adiciona o comentário ao Docklight
            		
        	'End If
    	'End If
	'DL.AddComment "Teste OK"
	'Wait(300)
    	' Aguarda brevemente antes de continuar o loop
End Sub
